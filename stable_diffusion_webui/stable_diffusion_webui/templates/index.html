{% extends 'base.html' %}
{% load inputs %}


{% block title %}
Generate Image
{% endblock %}



{% block body %}

<div class="row">
    <div class="col-4">
        <h1>Prompt</h1>
        <form id="generateForm">
            <div class="mb-3">
                <label class="form-label">Subject</label>
                <textarea class="form-control" rows="4" name="subject"></textarea>
            </div>
            {% multiple_check "medium" "Medium" mediums %}
            <p id="tips"></p>
            <button class="btn btn-primary" id="generateBtn" type="submit">Generate</button>
        </form>
    </div>
    <div class="col-8">
        <h1>Generated Images</h1>
        <div id="images"></div>
    </div>
</div>

<script>
$(document).ready(function(e){
    $("#generateForm").bind("submit", function(e) {

        var form = $("#generateForm");
        var btn = $("#generateBtn");
        btn.addClass("disabled");

        var formData = form.serializeArray();
        console.debug("generate images ", formData);

        // tranform form data to object
        var o = {};
        $.each(formData, function(){
            if (o[this.name]) {
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = [this.value || ""];
            }
        });
        o['subject'] = o['subject'][0];
        console.debug("request body ", o);

        $.ajax({
            url: "/generate_image/",
            type: "POST",
            data: JSON.stringify(o),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(resp) {
                btn.removeClass("disabled");
                
                var content = "";
                for(const row of resp.matrix) {
                    content += "<div class='row'>";
                    for(const item of row) {
                        let itemHtml = render_image(item);
                        content += itemHtml;
                    }
                    content += "</div>";
                }

                $("#images").html(content);
                
            },
            error: function(err) {
                console.error(err);
                var tips = $("#tips");
                tips.removeClass("");
                tips.addClass("text-danger");
                tips.html(err.statusText);
                btn.removeClass("disabled");
            }

        });

        return false;
    });
});
</script>

{% endblock %}